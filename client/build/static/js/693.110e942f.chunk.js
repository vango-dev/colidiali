"use strict";(self.webpackChunkclient_new_design=self.webpackChunkclient_new_design||[]).push([[693],{18693:(e,t,o)=>{o.r(t),o.d(t,{default:()=>k});var i=o(89379),n=o(19252),d=o(68903),r=o(12110),l=o(88911),a=o(85865),s=o(39336),u=o(96446),c=o(77739),p=o(65043),h=o(19255),x=o(99845),f=o(20974),g=o(19838),v=o(3487),m=o(30342),j=o(64793),y=o(15285),A=o(70393),w=o(88225),C=o(89096),S=o(85793),b=o(70579);function k(){const{user:e}=(0,m.A)(),t=(0,p.useRef)(),[,o]=(0,p.useState)([-180,-85,180,85]),[k,z]=(0,p.useState)(0),[E,G]=(0,p.useState)({latitude:0,longitude:0}),[J,W]=(0,p.useState)(!1),[I,L]=(0,p.useState)({latitude:34.0084,longitude:-6.8539,zoom:k}),[P,T]=(0,p.useState)(null),[_,D]=(0,p.useState)(null),[F,M]=(0,p.useState)(null),[N,X]=(0,p.useState)([]),{departure:Y}=(0,y.d4)(e=>e.departure);(0,p.useEffect)(()=>{(0,y.JD)((0,j.g0)())},[]),(0,p.useEffect)(()=>{t.current&&o(t.current.getMap().getBounds().toArray().flat())},[null===t||void 0===t?void 0:t.current]),(0,p.useEffect)(()=>{(async()=>{try{const t=await(0,w.I)(null===e||void 0===e?void 0:e.address);G(t)}catch(t){G({latitude:0,longitude:0})}})()},[null===e||void 0===e?void 0:e.address]),(0,p.useEffect)(()=>{Y?L({latitude:null===Y||void 0===Y?void 0:Y.departureCoordinates[0],longitude:null===Y||void 0===Y?void 0:Y.departureCoordinates[1],zoom:9}):null!==E&&void 0!==E&&E.latitude&&null!==E&&void 0!==E&&E.longitude&&L({latitude:E.latitude,longitude:E.longitude,zoom:4})},[Y,E]);const Z=(0,p.useCallback)(()=>{if(t.current){const e=t.current.getMap();Y?e.flyTo({center:[Y.departureCoordinates[1],Y.departureCoordinates[0]],zoom:9,duration:2e3}):E.latitude&&E.longitude&&e.flyTo({center:[E.longitude,E.latitude],zoom:4,duration:2e3})}},[Y,E]);(0,p.useEffect)(()=>{if(Y){const{departureCoordinates:e,destinationCoordinates:t,checkPoints:o}=Y;if(T([e[1],e[0]]),D([t[1],t[0]]),(null===o||void 0===o?void 0:o.length)>0){const e=null===o||void 0===o?void 0:o.map(e=>"".concat(e.coordinates.longitude.toFixed(4),",").concat(e.coordinates.latitude.toFixed(4))).join(";");e&&M(e)}else M(null)}else T(null),D(null),X([])},[Y]),(0,p.useEffect)(()=>{P&&_?(0,C.a)(P,_,F).then(e=>{X(e)}).catch(e=>console.error(e)):X([])},[P,_,F]);const B={type:"FeatureCollection",features:[{type:"feature",geometry:{type:"LineString",coordinates:[...N]}}]},Q=_?{type:"FeatureCollection",features:[{type:"feature",geometry:{type:"Point",coordinates:[..._]}}]}:null,R={id:"end",type:"circle",source:{type:"geojson",data:_},paint:{"circle-radius":4,"circle-color":"#f30"}};return(0,b.jsx)(g.A,{title:"Dashboard: Preview",children:(0,b.jsx)(n.A,{maxWidth:"xl",children:(0,b.jsx)(d.Ay,{container:!0,justifyContent:"center",alignItems:"center",children:(0,b.jsx)(d.Ay,{item:!0,xs:10,md:12,children:(0,b.jsxs)(r.A,{sx:{position:"relative"},children:[(0,b.jsxs)(l.A,{direction:"column",mx:3,my:2,children:[(0,b.jsx)(a.A,{variant:"h5",sx:{fontWeight:450,mb:1},children:"Profile Preview"}),(0,b.jsx)(s.A,{})]}),(0,b.jsx)(u.A,{sx:{display:"grid",columnGap:2,rowGap:3,height:800,width:"100%",px:{md:3,xs:2},pb:{md:3,xs:2},gridTemplateColumns:{xs:"repeat(1,1fr)"}},children:(0,b.jsxs)(h.Ay,{initialViewState:I,mapboxAccessToken:v.$1,mapStyle:"mapbox://styles/mapbox/streets-v11",ref:t,onZoomEnd:e=>z(Math.round(e.viewState.zoom)),zoom:k,onLoad:Z,children:[(0,b.jsx)(h.pH,{longitude:(null===Y||void 0===Y?void 0:Y.departureCoordinates[1])||(null===E||void 0===E?void 0:E.longitude),latitude:(null===Y||void 0===Y?void 0:Y.departureCoordinates[0])||(null===E||void 0===E?void 0:E.latitude),children:(0,b.jsx)(c.A,{title:"".concat(e.fName," ").concat(e.lName),children:(0,b.jsx)(x.ji,{elevation:2,onClick:()=>{W(!J),Z()},children:(0,b.jsx)(f.A,{icon:"flowbite:map-pin-alt-solid",width:25,height:25,sx:{color:"#000000"}})})})}),(0,b.jsx)(h.kL,{id:"routeSource",type:"geojson",data:B,children:(0,b.jsx)(h.Wd,(0,i.A)({},S.a))}),Q&&(0,b.jsx)(h.kL,{id:"endSource",type:"geojson",data:Q,children:(0,b.jsx)(h.Wd,(0,i.A)({},R))}),(0,b.jsx)(h.tG,{}),(0,b.jsx)(h.T3,{}),(0,b.jsx)(h.ov,{position:"top-right"})]})}),J&&(0,b.jsx)(l.A,{sx:{position:"absolute",top:"10%",left:"4%",height:{md:"90vh",lg:"90",xl:"75vh"},width:{lg:380,md:350,xs:350}},children:(0,b.jsx)(A.A,{transporter:e,nextDeparture:Y})})]})})})})})}},88225:(e,t,o)=>{async function i(e){try{if(e){const t=await fetch("https://api.mapbox.com/geocoding/v5/mapbox.places/".concat(e,".json?access_token=pk.eyJ1IjoiaWxpYXNzYW5hdGkiLCJhIjoiY2xuc3Rrb2hwMXlvejJrb2QxaG14ZXZzayJ9.BN3gUYZ3USajADQhJBvXQA"));if(t.ok){const e=await t.json();if(e.features&&e.features.length>0){const[t,o]=e.features[0].center;return{latitude:o,longitude:t}}}}throw new Error("Geocoding failed")}catch(t){return console.error("Error in geocoding:",t),{latitude:0,longitude:0}}}o.d(t,{I:()=>i})}}]);
//# sourceMappingURL=693.110e942f.chunk.js.map