"use strict";(self.webpackChunkclient_new_design=self.webpackChunkclient_new_design||[]).push([[631],{32749:(t,e,i)=>{i.d(e,{A:()=>w});var r=i(18403),s=i(80899),n=i(24858),o=i(43409),a=i(62098),d=i(72812),c=i(67254),l=i(88911),h=i(63336),p=i(17392),u=i(68903),x=i(64793),m=i(15285),g=i(65043),f=i(73216),A=i(20974),j=i(42379),y=i(70579);function w(t){let{withPaper:e=!0,searchParams:i}=t;console.log("\ud83d\ude80 ~ searchParams:",i);const w=(0,a.A)("up","md"),b=(0,o.A)(),{pathname:v}=(0,f.zy)(),[_,C]=(0,g.useState)(!1),k=(0,f.Zp)(),I=(0,m.wA)(),S="/"===v,M=s.Ik().shape({departure:s.Yj().required("* Ce champ est obligatoire"),destination:s.Yj().nullable(),date:s.p6().nullable()}),E=(0,g.useMemo)(()=>({departure:null===i||void 0===i?void 0:i.get("departure"),destination:(null===i||void 0===i?void 0:i.get("destination"))||void 0,date:i&&Date(i.get("date"))}),[i]),T=(0,n.mN)({resolver:(0,r.t)(M),defaultValues:E}),{handleSubmit:P,reset:F,setError:R,formState:{errors:B,isSubmitting:Z}}=T;(0,g.useEffect)(()=>{i&&F(i)},[i]);return(0,y.jsxs)(j.Op,{methods:T,onSubmit:P(async(t,e)=>{console.log("\ud83d\ude80 ~ onSubmit ~ data:",t);try{I((0,x.EO)(t)),k("/transporters/map?departure=".concat(null===t||void 0===t?void 0:t.departure,"&").concat(t&&t.destination&&"destination="+t.destination,"&").concat(t&&t.date&&"date="+t.date)),C(!_)}catch(i){console.error(i),F(),b.current&&(R("afterSubmit",i),console.log("\ud83d\ude80 ~ onSubmit ~ error:",i))}}),children:[!!B.afterSubmit&&(0,y.jsx)(c.A,{severity:"error",children:B.afterSubmit.message}),e?S?(0,y.jsxs)(l.A,{direction:{sm:"column",md:"row"},sx:{backgroundColor:{md:"white",sm:"none"},p:1,borderRadius:2},children:[(0,y.jsx)(h.A,{sx:{p:"2px 4px",display:"flex",marginBottom:{xs:5,md:0},width:{md:400,xs:"90%"}},children:(0,y.jsx)(j.Xq,{borderWidth:2,name:"departure",label:"Point de d\xe9part"})}),w&&(0,y.jsx)(p.A,{sx:{p:"10px"},children:(0,y.jsx)(A.A,{icon:"heroicons:arrows-right-left-20-solid"})}),(0,y.jsx)(h.A,{sx:{p:"2px 4px",display:"flex",marginBottom:{xs:5,md:0},width:{md:400,xs:"90%"}},children:(0,y.jsx)(j.Xq,{name:"destination",label:"Destination"})}),(0,y.jsxs)(h.A,{sx:{p:"2px 4px",display:"flex",mx:{sm:0,md:1},marginBottom:{xs:5,md:0},width:{md:400,xs:"90%"}},children:[(0,y.jsx)(j.L4,{name:"date",label:"Date de d\xe9part",variant:"body2"}),(0,y.jsx)(d.A,{type:"submit",loading:Z,sx:{background:"black",borderRadius:.5,width:{md:"25%"},height:{md:"90%",xs:"50%"},alignSelf:"center"},children:(0,y.jsx)(A.A,{icon:"fontisto:search",color:"white",width:25,height:25})})]})]}):(0,y.jsxs)(l.A,{direction:{xs:"column",md:"row"},sx:{backgroundColor:{md:"white",xs:"primary.main"},p:{md:1,xs:3},borderRadius:{md:2,xs:0},mt:{md:0,xs:"5.5vh"},width:{md:"42vw",xs:"100vw"}},gap:2,children:[(0,y.jsx)(h.A,{sx:{p:{md:"2px 4px",xs:0},display:"flex",width:{md:400,xs:"100%"}},children:(0,y.jsx)(j.Xq,{name:"departure",label:"Point de d\xe9part"})}),w&&(0,y.jsx)(p.A,{sx:{p:"10px"},children:(0,y.jsx)(A.A,{icon:"heroicons:arrows-right-left-20-solid"})}),(0,y.jsx)(h.A,{sx:{p:{md:"2px 4px",xs:0},display:"flex",width:{md:400,xs:"100%"}},children:(0,y.jsx)(j.Xq,{name:"destination",label:"Destination"})}),(0,y.jsxs)(h.A,{sx:{p:{md:"2px 4px",xs:0},display:"flex",mx:{sm:0,md:1},width:{md:400,xs:"100%"},mb:0},children:[(0,y.jsx)(j.L4,{name:"date",label:"Date de d\xe9part",variant:"body2"}),(0,y.jsx)(d.A,{type:"submit",loading:Z,sx:{background:"black",borderRadius:.5,width:{md:"25%"},height:{md:"90%",xs:"50%"},alignSelf:"center"},children:(0,y.jsx)(A.A,{icon:"fontisto:search",color:"white",width:25,height:25})})]})]}):(0,y.jsx)(l.A,{direction:"column",sx:{backgroundColor:{md:"white",sm:"none"},p:1.1,borderRadius:1,marginTop:12,marginBottom:2,marginLeft:"auto",width:"92%",position:"relative"},children:(0,y.jsx)(u.Ay,{container:!0,spacing:2,children:_?(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(u.Ay,{item:!0,md:11,children:(0,y.jsxs)(u.Ay,{container:!0,children:[(0,y.jsx)(u.Ay,{item:!0,md:12,children:(0,y.jsx)(j.Xq,{name:"departure",label:"Point de d\xe9part",variant:"caption",height:17,width:17})}),(0,y.jsx)(u.Ay,{item:!0,md:12,children:(0,y.jsx)(j.Xq,{name:"destination",label:"Destination",variant:"caption",height:17,width:17})})]})}),(0,y.jsx)(u.Ay,{item:!0,md:1,sx:{alignSelf:"center"},children:(0,y.jsx)(p.A,{sx:{p:"2px",color:"black"},children:(0,y.jsx)(A.A,{icon:"humbleicons:arrows-up-down",height:25,width:25,sx:{color:"black"}})})}),(0,y.jsx)(u.Ay,{item:!0,md:11,children:(0,y.jsx)(j.L4,{name:"date",label:"Date de d\xe9part",variant:"caption",height:17,width:17})}),(0,y.jsx)(u.Ay,{md:1,container:!0,sx:{display:"flex",justifyContent:"flex-start",alignItems:"center",mt:2},children:(0,y.jsx)(p.A,{type:"submit",sx:{background:"black",borderRadius:.5,ml:1},children:(0,y.jsx)(A.A,{icon:"fontisto:search",color:"white",width:20,height:20})})})]}):(0,y.jsx)(y.Fragment,{children:(0,y.jsx)(u.Ay,{item:!0,md:11,children:(0,y.jsx)(u.Ay,{container:!0,children:(0,y.jsx)(u.Ay,{item:!0,md:12,children:(0,y.jsx)(j.Xq,{name:"departure",label:"Point de d\xe9part",variant:"caption",height:17,width:17,onFocus:()=>C(!0)})})})})})})})]})}},49631:(t,e,i)=>{i.r(e),i.d(e,{default:()=>ot});var r=i(89379),s=i(26292),n=i(19255);const o=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class a{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[e,i]=new Uint8Array(t,0,2);if(219!==e)throw new Error("Data does not appear to be in a KDBush format.");const r=i>>4;if(1!==r)throw new Error("Got v".concat(r," data when expected v").concat(1,"."));const s=o[15&i];if(!s)throw new Error("Unrecognized array type.");const[n]=new Uint16Array(t,2,1),[d]=new Uint32Array(t,4,1);return new a(d,n,s,t)}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:64,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Float64Array,r=arguments.length>3?arguments[3]:void 0;if(isNaN(t)||t<0)throw new Error("Unpexpected numItems value: ".concat(t,"."));this.numItems=+t,this.nodeSize=Math.min(Math.max(+e,2),65535),this.ArrayType=i,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const s=o.indexOf(this.ArrayType),n=2*t*this.ArrayType.BYTES_PER_ELEMENT,a=t*this.IndexArrayType.BYTES_PER_ELEMENT,d=(8-a%8)%8;if(s<0)throw new Error("Unexpected typed array class: ".concat(i,"."));r&&r instanceof ArrayBuffer?(this.data=r,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+a+d,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+n+a+d),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+a+d,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+s]),new Uint16Array(this.data,2,1)[0]=e,new Uint32Array(this.data,4,1)[0]=t)}add(t,e){const i=this._pos>>1;return this.ids[i]=i,this.coords[this._pos++]=t,this.coords[this._pos++]=e,i}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error("Added ".concat(t," items when expected ").concat(this.numItems,"."));return d(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,e,i,r){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:s,coords:n,nodeSize:o}=this,a=[0,s.length-1,0],d=[];for(;a.length;){const c=a.pop()||0,l=a.pop()||0,h=a.pop()||0;if(l-h<=o){for(let o=h;o<=l;o++){const a=n[2*o],c=n[2*o+1];a>=t&&a<=i&&c>=e&&c<=r&&d.push(s[o])}continue}const p=h+l>>1,u=n[2*p],x=n[2*p+1];u>=t&&u<=i&&x>=e&&x<=r&&d.push(s[p]),(0===c?t<=u:e<=x)&&(a.push(h),a.push(p-1),a.push(1-c)),(0===c?i>=u:r>=x)&&(a.push(p+1),a.push(l),a.push(1-c))}return d}within(t,e,i){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:r,coords:s,nodeSize:n}=this,o=[0,r.length-1,0],a=[],d=i*i;for(;o.length;){const c=o.pop()||0,l=o.pop()||0,h=o.pop()||0;if(l-h<=n){for(let i=h;i<=l;i++)p(s[2*i],s[2*i+1],t,e)<=d&&a.push(r[i]);continue}const u=h+l>>1,x=s[2*u],m=s[2*u+1];p(x,m,t,e)<=d&&a.push(r[u]),(0===c?t-i<=x:e-i<=m)&&(o.push(h),o.push(u-1),o.push(1-c)),(0===c?t+i>=x:e+i>=m)&&(o.push(u+1),o.push(l),o.push(1-c))}return a}}function d(t,e,i,r,s,n){if(s-r<=i)return;const o=r+s>>1;c(t,e,o,r,s,n),d(t,e,i,r,o-1,1-n),d(t,e,i,o+1,s,1-n)}function c(t,e,i,r,s,n){for(;s>r;){if(s-r>600){const o=s-r+1,a=i-r+1,d=Math.log(o),l=.5*Math.exp(2*d/3),h=.5*Math.sqrt(d*l*(o-l)/o)*(a-o/2<0?-1:1);c(t,e,i,Math.max(r,Math.floor(i-a*l/o+h)),Math.min(s,Math.floor(i+(o-a)*l/o+h)),n)}const o=e[2*i+n];let a=r,d=s;for(l(t,e,r,i),e[2*s+n]>o&&l(t,e,r,s);a<d;){for(l(t,e,a,d),a++,d--;e[2*a+n]<o;)a++;for(;e[2*d+n]>o;)d--}e[2*r+n]===o?l(t,e,r,d):(d++,l(t,e,d,s)),d<=i&&(r=d+1),i<=d&&(s=d-1)}}function l(t,e,i,r){h(t,i,r),h(e,2*i,2*r),h(e,2*i+1,2*r+1)}function h(t,e,i){const r=t[e];t[e]=t[i],t[i]=r}function p(t,e,i,r){const s=t-i,n=e-r;return s*s+n*n}const u={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:t=>t},x=Math.fround||(m=new Float32Array(1),t=>(m[0]=+t,m[0]));var m;function g(t,e,i){return{type:"Feature",id:t[e+3],properties:f(t,e,i),geometry:{type:"Point",coordinates:[(r=t[e],360*(r-.5)),y(t[e+1])]}};var r}function f(t,e,i){const r=t[e+5],s=r>=1e4?"".concat(Math.round(r/1e3),"k"):r>=1e3?"".concat(Math.round(r/100)/10,"k"):r,n=t[e+6],o=-1===n?{}:Object.assign({},i[n]);return Object.assign(o,{cluster:!0,cluster_id:t[e+3],point_count:r,point_count_abbreviated:s})}function A(t){return t/360+.5}function j(t){const e=Math.sin(t*Math.PI/180),i=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return i<0?0:i>1?1:i}function y(t){const e=(180-360*t)*Math.PI/180;return 360*Math.atan(Math.exp(e))/Math.PI-90}var w=i(34535),b=i(20974),v=i(19838),_=i(32749),C=i(12110),k=i(79958),I=i(17392),S=i(68903),M=i(26494),E=i(88911),T=i(63336),P=i(81045),F=i(85865),R=i(76641),B=i(65043),Z=i(73856),z=i(79445),D=i(99845),L=i(62098),O=i(15285),U=i(73338),N=i(1386),q=i(70393),X=i(70579);const H=(0,w.Ay)(s.m.div)(t=>{let{theme:e}=t;return{backgroundColor:"transparent",position:"absolute",left:0,top:"58.5vh",zIndex:3,width:"100%",height:"100vh",[e.breakpoints.up("md")]:{top:0,position:"relative",height:"76vh",width:"92%",marginLeft:"auto"}}}),Y=(0,w.Ay)(s.m.div)(t=>{let{theme:e}=t;return{backgroundColor:"transparent",position:"absolute",top:"7vh",left:0,zIndex:4,width:"100%",[e.breakpoints.up("md")]:{width:"2%",height:"79vh",marginLeft:"auto",top:"15%",left:"35%"}}}),W=(0,w.Ay)(C.A)(t=>{let{theme:e}=t;return{boxShadow:"none",textAlign:"center",height:"40%",backgroundColor:"#FFFFFF",backgroundImage:"url(/assets/mozaic_transporters_bg.png)",overflow:"auto",[e.breakpoints.up("md")]:{height:"100%"},[e.breakpoints.down("sm")]:{borderRadius:20,paddingBottom:10}}});function G(t){let{onSelectTransporter:e,selectedTransporterFromMap:i,onIconClick:s}=t;const n=(0,L.A)("up","md"),{futurDepartures:o}=(0,O.d4)(t=>t.departure),[a,d]=(0,B.useState)(""),[c,l]=(0,B.useState)(""),[h,p]=(0,B.useState)(!1),u=t=>{c&&t._id===c._id?p(!h):(l(t),p(!0),t&&e(t))};(0,B.useEffect)(()=>{d(i),i&&u(i)},[i]);const[x,m]=(0,B.useState)({});return(0,X.jsxs)(D.qH,{children:[(0,X.jsx)(H,{children:(0,X.jsxs)(W,{children:[(0,X.jsx)(k.A,{title:(0,X.jsxs)(X.Fragment,{children:[!n&&(0,X.jsx)(I.A,{onClick:s,sx:{textAlign:"center",width:"100%",p:0,m:0},children:(0,X.jsx)(b.A,{icon:"pepicons-pop:line-x",width:50})}),(0,X.jsxs)(S.Ay,{container:!0,justifyContent:"space-between",mt:1,px:2,children:[(0,X.jsx)(S.Ay,{item:!0,children:"Nombre de transporteurs trouv\xe9s :"}),(0,X.jsx)(S.Ay,{item:!0,children:null===o||void 0===o?void 0:o.length})]})]}),sx:{textAlign:"start",p:{xs:0},margin:0}}),(0,X.jsx)(M.A,{children:(0,X.jsx)(E.A,{direction:"column",sx:{width:"100%",textAlign:"start"},spacing:2,children:null===o||void 0===o?void 0:o.map((t,e)=>(0,X.jsx)(V,{departure:t,onClick:()=>{u(t),(t=>{m(e=>(0,r.A)((0,r.A)({},e),{},{[t]:!e[t]}))})(e)},selected:a===t,openCard:x[e]||!1},e))})})]})}),(0,X.jsx)(Y,{children:h&&(0,X.jsx)(E.A,{sx:{width:{md:"21vw",xs:"100vw"}},children:(0,X.jsx)(q.A,{transporter:c.transporterId,nextDeparture:c})})})]})}function V(t){let{departure:e,onClick:i,selected:r,openCard:s}=t;const{fName:n,lName:o,transporterPhoto:a,companyActivity:d,totalRating:c,images:l}=e.transporterId,{departurePoint:h,destinationPoint:p,departureTime:u}=e;return(0,X.jsx)(T.A,{sx:{mx:1.5,borderRadius:1,border:r?"2px solid":"none",my:1},children:(0,X.jsxs)(S.Ay,{container:!0,justifyContent:"space-between",children:[(0,X.jsx)(S.Ay,{item:!0,md:8,sx:{position:"relative",display:"flex",alignItems:"center","&::before":{content:'""',position:"absolute",right:0,height:"80%",borderRight:"solid 1px #B0B0B0"}},children:(0,X.jsxs)(E.A,{spacing:2.5,sx:{p:3,pb:2.5,width:"100%"},children:[(0,X.jsxs)(E.A,{direction:"row",alignItems:"center",spacing:2,children:[(0,X.jsx)(P.A,{alt:"name",src:a}),(0,X.jsxs)("div",{children:[(0,X.jsxs)(F.A,{variant:"subtitle2",children:[n," ",o]}),(0,X.jsxs)(E.A,{direction:"row",display:"flex",alignItems:"center",mt:.5,spacing:1,children:[(0,X.jsx)(b.A,{icon:"mdi:truck",width:16,height:16}),(0,X.jsx)(F.A,{variant:"caption",sx:{color:"text.disabled",display:"block"},children:d})]})]})]}),(0,X.jsxs)(E.A,{direction:"row",alignItems:"center",spacing:1,sx:{color:"#000000"},children:[(0,X.jsxs)(E.A,{direction:"row",alignItems:"center",spacing:1,children:[(0,X.jsx)(F.A,{variant:"caption",children:h}),(0,X.jsx)(b.A,{icon:"uil:arrow-right",sx:{width:"10%"},width:18,height:18})]}),(0,X.jsx)(E.A,{direction:"row",alignItems:"center",children:(0,X.jsxs)(F.A,{variant:"caption",children:[" ",p]})})]}),(0,X.jsxs)(E.A,{direction:"row",alignItems:"center",spacing:2,children:[(0,X.jsx)(F.A,{variant:"caption",sx:{color:"#F56B3D"},children:"Prochain d\xe9part :"}),(0,X.jsxs)(E.A,{direction:"row",alignItems:"center",spacing:1,sx:{borderStyle:"solid",borderWidth:"2px",borderRadius:1,borderColor:"text.disabled",p:"3px"},children:[(0,X.jsx)(F.A,{variant:"caption",children:(0,N.ts)(u)})," ",(0,X.jsx)(b.A,{icon:"iconoir:calendar",width:18,height:18})]})]}),(0,X.jsx)(E.A,{direction:"row",alignItems:"center",spacing:1,children:(0,X.jsx)(z.A,{initialColor:!0})})]})}),(0,X.jsxs)(S.Ay,{item:!0,md:4,children:[(0,X.jsxs)(E.A,{direction:"row",justifyContent:"center",alignItems:"center",spacing:1,paddingTop:1,children:[(0,X.jsx)(F.A,{variant:"body2",sx:{color:"text.secondary"},children:c}),(0,X.jsx)(R.A,{value:c,size:"small",readOnly:!0,precision:.5,sx:{"& .MuiRating-iconFilled":{color:"#000000"},"& .MuiRating-iconEmpty":{color:"#000000"}}}),(0,X.jsxs)(F.A,{variant:"body2",sx:{color:"text.secondary"},children:["(",(0,U.R)(0),")"]})]}),(0,X.jsx)(E.A,{direction:"row",sx:{p:2.5,display:"flex"},children:(0,X.jsx)(Z.A,{src:l[0],ratio:"1/1",sx:{borderRadius:1.5}})}),(0,X.jsx)(E.A,{direction:"row",alignItems:"center",justifyContent:"flex-end",mr:2,children:(0,X.jsx)(I.A,{size:"small",onClick:i,children:(0,X.jsx)(b.A,{icon:s?"ri:arrow-right-s-line":"ri:arrow-left-s-line",width:20,height:20,sx:{border:"1px solid #E5E8EB",borderRadius:"5px"}})})})]})]})})}var K=i(96446),$=i(77739),J=i(78977),Q=i(35475),tt=i(3487),et=i(62631),it=i(89096),rt=i(85793);const st=(0,w.Ay)("div")(t=>{let{theme:e}=t;return{height:"100%",width:"100%",backgroundColor:e.palette.background.default,background:"linear-gradient(180deg, #033B3A 0%, #033938 0%, #02302F 19.03%, #000000 100%);"}}),nt=new class{constructor(t){this.options=Object.assign(Object.create(u),t),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(t){const{log:e,minZoom:i,maxZoom:r}=this.options;e&&console.time("total time");const s="prepare ".concat(t.length," points");e&&console.time(s),this.points=t;const n=[];for(let a=0;a<t.length;a++){const e=t[a];if(!e.geometry)continue;const[i,r]=e.geometry.coordinates,s=x(A(i)),o=x(j(r));n.push(s,o,1/0,a,-1,1),this.options.reduce&&n.push(0)}let o=this.trees[r+1]=this._createTree(n);e&&console.timeEnd(s);for(let a=r;a>=i;a--){const t=+Date.now();o=this.trees[a]=this._createTree(this._cluster(o,a)),e&&console.log("z%d: %d clusters in %dms",a,o.numItems,+Date.now()-t)}return e&&console.timeEnd("total time"),this}getClusters(t,e){let i=((t[0]+180)%360+360)%360-180;const r=Math.max(-90,Math.min(90,t[1]));let s=180===t[2]?180:((t[2]+180)%360+360)%360-180;const n=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)i=-180,s=180;else if(i>s){const t=this.getClusters([i,r,180,n],e),o=this.getClusters([-180,r,s,n],e);return t.concat(o)}const o=this.trees[this._limitZoom(e)],a=o.range(A(i),j(n),A(s),j(r)),d=o.data,c=[];for(const l of a){const t=this.stride*l;c.push(d[t+5]>1?g(d,t,this.clusterProps):this.points[d[t+3]])}return c}getChildren(t){const e=this._getOriginId(t),i=this._getOriginZoom(t),r="No cluster with the specified id.",s=this.trees[i];if(!s)throw new Error(r);const n=s.data;if(e*this.stride>=n.length)throw new Error(r);const o=this.options.radius/(this.options.extent*Math.pow(2,i-1)),a=n[e*this.stride],d=n[e*this.stride+1],c=s.within(a,d,o),l=[];for(const h of c){const e=h*this.stride;n[e+4]===t&&l.push(n[e+5]>1?g(n,e,this.clusterProps):this.points[n[e+3]])}if(0===l.length)throw new Error(r);return l}getLeaves(t,e,i){e=e||10,i=i||0;const r=[];return this._appendLeaves(r,t,e,i,0),r}getTile(t,e,i){const r=this.trees[this._limitZoom(t)],s=Math.pow(2,t),{extent:n,radius:o}=this.options,a=o/n,d=(i-a)/s,c=(i+1+a)/s,l={features:[]};return this._addTileFeatures(r.range((e-a)/s,d,(e+1+a)/s,c),r.data,e,i,s,l),0===e&&this._addTileFeatures(r.range(1-a/s,d,1,c),r.data,s,i,s,l),e===s-1&&this._addTileFeatures(r.range(0,d,a/s,c),r.data,-1,i,s,l),l.features.length?l:null}getClusterExpansionZoom(t){let e=this._getOriginZoom(t)-1;for(;e<=this.options.maxZoom;){const i=this.getChildren(t);if(e++,1!==i.length)break;t=i[0].properties.cluster_id}return e}_appendLeaves(t,e,i,r,s){const n=this.getChildren(e);for(const o of n){const e=o.properties;if(e&&e.cluster?s+e.point_count<=r?s+=e.point_count:s=this._appendLeaves(t,e.cluster_id,i,r,s):s<r?s++:t.push(o),t.length===i)break}return s}_createTree(t){const e=new a(t.length/this.stride|0,this.options.nodeSize,Float32Array);for(let i=0;i<t.length;i+=this.stride)e.add(t[i],t[i+1]);return e.finish(),e.data=t,e}_addTileFeatures(t,e,i,r,s,n){for(const o of t){const t=o*this.stride,a=e[t+5]>1;let d,c,l;if(a)d=f(e,t,this.clusterProps),c=e[t],l=e[t+1];else{const i=this.points[e[t+3]];d=i.properties;const[r,s]=i.geometry.coordinates;c=A(r),l=j(s)}const h={type:1,geometry:[[Math.round(this.options.extent*(c*s-i)),Math.round(this.options.extent*(l*s-r))]],tags:d};let p;p=a||this.options.generateId?e[t+3]:this.points[e[t+3]].id,void 0!==p&&(h.id=p),n.features.push(h)}}_limitZoom(t){return Math.max(this.options.minZoom,Math.min(Math.floor(+t),this.options.maxZoom+1))}_cluster(t,e){const{radius:i,extent:r,reduce:s,minPoints:n}=this.options,o=i/(r*Math.pow(2,e)),a=t.data,d=[],c=this.stride;for(let l=0;l<a.length;l+=c){if(a[l+2]<=e)continue;a[l+2]=e;const i=a[l],r=a[l+1],h=t.within(a[l],a[l+1],o),p=a[l+5];let u=p;for(const t of h){const i=t*c;a[i+2]>e&&(u+=a[i+5])}if(u>p&&u>=n){let t,n=i*p,o=r*p,x=-1;const m=(l/c<<5)+(e+1)+this.points.length;for(const i of h){const r=i*c;if(a[r+2]<=e)continue;a[r+2]=e;const d=a[r+5];n+=a[r]*d,o+=a[r+1]*d,a[r+4]=m,s&&(t||(t=this._map(a,l,!0),x=this.clusterProps.length,this.clusterProps.push(t)),s(t,this._map(a,r)))}a[l+4]=m,d.push(n/u,o/u,1/0,m,-1,u),s&&d.push(x)}else{for(let t=0;t<c;t++)d.push(a[l+t]);if(u>1)for(const t of h){const i=t*c;if(!(a[i+2]<=e)){a[i+2]=e;for(let t=0;t<c;t++)d.push(a[i+t])}}}}return d}_getOriginId(t){return t-this.points.length>>5}_getOriginZoom(t){return(t-this.points.length)%32}_map(t,e,i){if(t[e+5]>1){const r=this.clusterProps[t[e+6]];return i?Object.assign({},r):r}const r=this.points[t[e+3]].properties,s=this.options.map(r);return i&&s===r?Object.assign({},s):s}}({radius:75,maxZoom:20});function ot(){const t=(0,L.A)("up","md"),[e,i]=(0,B.useState)(""),[o,a]=(0,B.useState)(!1),[d,c]=(0,B.useState)([-180,-85,180,85]),[l,h]=(0,B.useState)([]),[p,u]=(0,B.useState)([]),[x,m]=(0,B.useState)(5),[g,f]=(0,B.useState)(null),[A,j]=(0,B.useState)(null),[y,w]=(0,B.useState)(null),[C,k]=(0,B.useState)([]),[I,M]=(0,Q.ok)(),E=(0,O.wA)(),{futurDepartures:T}=(0,O.d4)(t=>t.departure),P=(0,B.useRef)();(0,B.useEffect)(()=>{const t=null===T||void 0===T?void 0:T.map(t=>({type:"Feature",properties:{cluster:!1,departure:t},geometry:{type:"Point",coordinates:[null===t||void 0===t?void 0:t.departureCoordinates.coordinates[0],null===t||void 0===t?void 0:t.departureCoordinates.coordinates[1]]}}));u(t)},[T]),(0,B.useEffect)(()=>{nt.load(p),h(nt.getClusters(d,x))},[p,x,d]),(0,B.useEffect)(()=>{P.current&&c(P.current.getMap().getBounds().toArray().flat())},[null===P||void 0===P?void 0:P.current]),(0,B.useEffect)(()=>{g&&A?(0,it.a)(g,A,y).then(t=>{k(t)}).catch(t=>console.error(t)):k([])},[g,A,y]);const R={type:"FeatureCollection",features:[{type:"feature",geometry:{type:"LineString",coordinates:[...C]}}]},Z=A?{type:"FeatureCollection",features:[{type:"feature",geometry:{type:"Point",coordinates:[...A]}}]}:null,z={id:"end",type:"circle",source:{type:"geojson",data:A},paint:{"circle-radius":4,"circle-color":"#f30"}},U=(0,B.useCallback)(t=>{var e;null===(e=P.current)||void 0===e||e.flyTo({center:[null===t||void 0===t?void 0:t.departureCoordinates.coordinates[0],null===t||void 0===t?void 0:t.departureCoordinates.coordinates[1]],duration:5e3})},[]);return(0,X.jsx)(D.qH,{children:(0,X.jsx)(v.A,{title:"Carte transporteurs",children:(0,X.jsx)(st,{children:(0,X.jsxs)(S.Ay,{container:!0,justifyContent:"space-between",children:[o&&(0,X.jsx)(S.Ay,{item:!0,md:4,children:(0,X.jsxs)(S.Ay,{container:!0,justifyContent:"flex-end",alignItems:"center",children:[(0,X.jsx)(S.Ay,{item:!0,md:12,children:(0,X.jsx)(s.m.div,{children:(0,X.jsx)(_.A,{withPaper:!t,searchParams:I})})}),(0,X.jsx)(S.Ay,{item:!0,md:12,children:(0,X.jsx)(G,{onSelectTransporter:U,selectedTransporterFromMap:e,onIconClick:()=>{a(!o)}})})]})}),(0,X.jsx)(S.Ay,{item:!0,md:o?8:12,children:(0,X.jsx)(X.Fragment,{children:(0,X.jsx)(K.A,{height:t?"92vh":o?"65vh":"89vh",width:t?"100%":"100vw",sx:{marginTop:t?8:o?0:8,paddingY:t&&2,paddingRight:t?5:0,paddingLeft:t?3:0},children:(0,X.jsxs)(n.Ay,{initialViewState:{latitude:34.0084,longitude:-6.8539},style:{borderRadius:t?"6px":0},mapboxAccessToken:tt.$1,mapStyle:"mapbox://styles/mapbox/streets-v11",ref:P,onZoomEnd:t=>m(Math.round(t.viewState.zoom)),children:[null===l||void 0===l?void 0:l.map(t=>{const{cluster:e,point_count:r}=t.properties,[s,o]=t.geometry.coordinates;return e?(0,X.jsx)(n.pH,{longitude:s,latitude:o,children:(0,X.jsx)("div",{className:"cluster-marker",style:{width:"".concat(10+r/p.length*25,"px"),height:"".concat(10+r/p.length*25,"px")},onClick:()=>{const e=Math.min(nt.getClusterExpansionZoom(t.id),20);P.current.flyTo({center:[s,o],zoom:e,speed:1})},children:(0,X.jsx)(F.A,{variant:"subtitle2",children:r})})},"cluster-".concat(t.id)):(0,X.jsx)(n.pH,{longitude:s,latitude:o,children:(0,X.jsx)($.A,{title:"".concat(t.properties.departure.transporterId.fName," ").concat(t.properties.departure.transporterId.lName),children:(0,X.jsx)(D.ji,{elevation:2,onClick:()=>{U(t.properties.departure),a(!0),i(t.properties.departure)},children:(0,X.jsx)(b.A,{icon:"flowbite:map-pin-alt-solid",width:25,height:25,sx:{color:"#000000"}})})})},"Transporteur-".concat(t.properties.departure._id))}),(0,X.jsx)(n.kL,{id:"routeSource",type:"geojson",data:R,children:(0,X.jsx)(n.Wd,(0,r.A)({},rt.a))}),Z&&(0,X.jsx)(n.kL,{id:"endSource",type:"geojson",data:Z,children:(0,X.jsx)(n.Wd,(0,r.A)({},z))}),(0,X.jsx)(n.tG,{}),(0,X.jsx)(n.T3,{}),(0,X.jsx)(n.ov,{}),g&&(0,X.jsx)(n.pH,{longitude:g[0],latitude:g[1]})]})})})}),(0,X.jsx)(J.A,{variant:"contained",color:"warning",size:"large",sx:{position:"absolute",zIndex:1,left:t?o?"60%":"45%":"30%",bottom:"5%"},startIcon:(0,X.jsx)(b.A,{icon:"gravity-ui:list-ul",width:20,height:20}),onClick:()=>{a(!o),E((0,et.mu)()),i("")},children:o?"Cacher les transporteurs":"Afficher les transporteurs"})]})})})})}}}]);
//# sourceMappingURL=631.298abf1a.chunk.js.map